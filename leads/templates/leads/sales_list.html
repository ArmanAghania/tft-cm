{% extends "base.html" %}
{% load humanize %}
{% load custom_filters %}
{% block content %}
<h1 class="text-4xl text-gray-800">Sales</h1>
</br>
<div class="flex flex-col w-full">
    <div class="flex mb-4">
        <button class="tab-selector w-1/2 py-2" data-target="allSalesContent">All Sales</button>
        <button class="tab-selector w-1/2 py-2" data-target="monthlySalesContent">Monthly Sales</button>
    </div>
    <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
    <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
    <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
    <div id="allSalesContent" class="tab-content">
    <table id="allSalesTable" class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone Number</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Agent</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th scope="col" class="relative px-6 py-3"></th>
            </tr>
        </thead>
        <tbody class="text-gray-700">
            {% for sale in all_sales %}
                <tr class="bg-white  border-b">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.lead.phone_number }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.agent.user.first_name }} {{ sale.agent.user.last_name}} || {{ sale.agent.user.alt_name}}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.amount|intcomma }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.date|to_jalali }}</td>
                    <td class=" py-2 px-4 text-center">
                        <a href="{% url 'leads:lead-sales-update' sale.lead.pk %}" class="text-blue-600 hover:text-blue-800">Edit</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    <div id="monthlySalesContent" class="tab-content hidden">
    <table id="monthlySalesTable" class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone Number</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Agent</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th scope="col" class="relative px-6 py-3"></th>
            </tr>
        </thead>
        <tbody class="text-gray-700">
            {% for sale in monthly_sales %}
                <tr class="bg-white  border-b">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.lead.phone_number }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.agent.user.first_name }} {{ sale.agent.user.last_name}} || {{ sale.agent.user.alt_name}}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.amount|intcomma }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.date|to_jalali }}</td>
                    <td class=" py-2 px-4 text-center">
                        <a href="{% url 'leads:lead-sales-update' sale.lead.pk %}" class="text-blue-600 hover:text-blue-800">Edit</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</div>
</div>
</div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize DataTables for both tables
        const allSalesTableDT = $('#allSalesTable').DataTable({
            dom: 'Bfrtip',
            buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5']
        });
    
        const monthlySalesTableDT = $('#monthlySalesTable').DataTable({
            dom: 'Bfrtip',
            buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5']
        });
    
        // Tab functionality
        const tabSelectors = document.querySelectorAll('.tab-selector');
        tabSelectors.forEach(function(tabSelector) {
            tabSelector.addEventListener('click', function(event) {
                
                // Remove active state from all tabs
                tabSelectors.forEach(function(tab) {
                    tab.classList.remove('bg-blue-500', 'text-white');
                });
    
                // Add active state to the clicked tab
                event.target.classList.add('bg-blue-500', 'text-white');
    
                // Hide all tab contents
                const tabContents = document.querySelectorAll('.tab-content');
                tabContents.forEach(function(content) {
                    content.classList.add('hidden');
                });
                
                // Get target content's id from data attribute of clicked button
                const targetId = event.target.getAttribute('data-target');
                // Display the target content
                const targetContent = document.getElementById(targetId);
                if (targetContent) {
                    targetContent.classList.remove('hidden');
                }
    
                // Adjust columns for DataTables when tables are shown
                if (targetId === 'allSalesContent') {
                    allSalesTableDT.columns.adjust().draw();
                } else if (targetId === 'monthlySalesContent') {
                    monthlySalesTableDT.columns.adjust().draw();
                }
            });
        });
    });
    
    
</script>

<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.css">
<!-- DataTables Buttons extension CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">

<!-- jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables JS -->
<script type="text/javascript" src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.js"></script>
<!-- DataTables Buttons extension JS -->
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>

        
{% endblock %}
