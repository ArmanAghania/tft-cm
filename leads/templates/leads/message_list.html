{% extends 'base.html' %}

{% block title %} Messages {% endblock title %}
{% block content %}
<form method="get" action="{% url 'leads:message_list' %}" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
    {% csrf_token %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <!-- Date Range Inputs -->
        <div>
            <label for="start_date" class="block text-gray-700 text-sm font-bold mb-2">Start Date:</label>
            <input type="date" id="start_date" name="start_date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>
        
        <div>
            <label for="end_date" class="block text-gray-700 text-sm font-bold mb-2">End Date:</label>
            <input type="date" id="end_date" name="end_date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>
        
        <!-- Keyword Search Input -->
        <div>
            <label for="keyword" class="block text-gray-700 text-sm font-bold mb-2">Search Keyword:</label>
            <input type="text" id="keyword" name="keyword" placeholder="Enter keyword" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <!-- Radio Buttons for Deletion Status -->
        <div class="md:col-span-2">
            <span class="block text-gray-700 text-sm font-bold mb-2">Deletion Status:</span>
            <div class="flex items-center">
                <label class="inline-flex items-center mr-6">
                    <input type="radio" name="deletion_status" value="all" class="form-radio text-blue-600" checked>
                    <span class="ml-2">All</span>
                </label>
                <label class="inline-flex items-center mr-6">
                    <input type="radio" name="deletion_status" value="true" class="form-radio text-blue-600">
                    <span class="ml-2">Deleted</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" name="deletion_status" value="false" class="form-radio text-blue-600">
                    <span class="ml-2">Not Deleted</span>
                </label>
            </div>
        </div>
    </div>
    <!-- Submit Button -->
    <div class="flex justify-end mb-2">
        <button type="submit" class="mx-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
            Filter Messages
        </button>
    </div>
</form>


<form method="post" action="{% url 'leads:delete_messages' %}" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
    {% csrf_token %}
    <div class="flex justify-end mb-2">
    <button type="submit" class="ml-2 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
        Delete Selected
    </button>
    </div>
    <table class="min-w-full leading-normal">
        <thead>
            <tr>
                {% comment %} <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100">
                </th> {% endcomment %}
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    <input type="checkbox" id="select-all" class="leading-tight">
                    Select
                </th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    Chat Name
                </th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    Message
                </th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    Date Sent
                </th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    Deleted
                </th>
            </tr>
        </thead>
        <tbody>
            {% for message in tg_messages %}
            <tr>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    <input type="checkbox" name="message_ids" value="{{ message.message_id }}" class="leading-tight">
                </td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    {{ message.chat_name }}
                </td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    <p class="text-gray-900 whitespace-no-wrap overflow-ellipsis overflow-hidden" style="max-width: 300px;">{{ message.text|truncatechars:100 }}</p>
                </td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    {{ message.sent_date }}
                </td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    {{ message.deleted }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</form>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('select-all').addEventListener('change', function (event) {
            var checkboxes = document.querySelectorAll('input[type="checkbox"][name="message_ids"]');
            checkboxes.forEach(function(checkbox) {
                checkbox.checked = event.target.checked;
            });
        });
    });
</script>
{% endblock %}
